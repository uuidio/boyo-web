(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-726daaae"],{"358b":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"goodsList",on:{click:function(e){return t.getGoods()}}},[i("div",{on:{click:t.openModel}},[t._t("default")],2),i("a-modal",{attrs:{width:"80%",title:"商品列表"},on:{ok:t.selectGoods},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"mb20 text-r"},[i("a-input-search",{staticStyle:{width:"22rem"},attrs:{enterButton:"",placeholder:"请输入名称搜索"},on:{search:t.onSearch}}),i("a-form-item",{staticStyle:{display:"inline-block","margin-left":"10px",width:"400px"},attrs:{label:"分类选择","label-col":{xs:{span:24},md:{span:6}},"wrapper-col":{xs:{span:24},md:{span:18}}}},[i("a-cascader",{staticStyle:{width:"100%"},attrs:{options:t.classTree,placeholder:"请选择分类",changeOnSelect:""},on:{change:t.changeClass}})],1)],1),t.listField&&t.listField.length>0?[i("a-table",{staticClass:"components-table-demo-nested",attrs:{rowKey:function(t){return t.id},scroll:{y:400,x:1200},rowSelection:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange,type:t.seleteType},loading:t.tabLoading,columns:t.listField,dataSource:t.listData,pagination:!1},scopedSlots:t._u([{key:"goods_image",fn:function(t,e){return i("div",{},[i("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.goods_image,alt:""}})])}}],null,!1,828441971)}),i("div",{staticClass:"pages"},[i("a-pagination",{attrs:{total:t.pages.total,showTotal:function(t){return"共 "+t+" 条数据"},pageSize:Number(t.pages.per_page),defaultCurrent:1},on:{change:t.changePage}})],1)]:t._e()],2)],1)},o=[],n=(i("5ab2"),i("6d57"),i("e10e"),i("163d"),i("ce3c")),a=i("804d"),r=i("c1fb"),l=i("c968"),c=i("9f3a");function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var m={name:"goodsList",computed:u({},Object(c["c"])({classTree:function(t){return t.goods.goodsClassTree}})),data:function(){return{visible:!1,tabLoading:!0,params:{page:1,keyword:"",goods_state:1,gc_id_1:"",gc_id_2:"",gc_id_3:""},selectedRowKeys:[],ids:[],selection:[],listData:[],listField:[],pages:{},shopParams:{per_page:1e6,is_open:1}}},watch:{},props:{linkType:{type:String,default:"goods"},seleteType:{type:String,default:"checkbox"},maxNum:{type:Number,default:1e5},defaultKeys:{type:Array,default:function(){return[]}},otherParam:{type:Object,default:function(){}}},mounted:function(){this.defaultKeys.length>0&&(this.selectedRowKeys=this.defaultKeys),this.otherParam&&(console.log(this.otherParam),Object.assign(this.params,this.otherParam)),this.getClassTree()},methods:u(u({},Object(c["b"])({getClassTree:"goods/getGoodsClassTree"})),{},{changeClass:function(t){t.length>0?(this.params.gc_id_1=t[0],this.params.gc_id_2=t[1]||"",this.params.gc_id_3=t[2]||""):(this.params.gc_id_1="",this.params.gc_id_2="",this.params.gc_id_3="")},changePage:function(t){this.params.page=t,this.getGoods()},onSelectChange:function(t,e){if("checkbox"===this.seleteType){if(t.length>this.maxNum)return void this.$message.warning("最大选择数量为"+this.maxNum);this.selectedRowKeys=t;for(var i=0;i<e.length;i++)if(-1===this.ids.indexOf(e[i].id)){var s=[];"goods"===this.linkType?(s.id=e[i].id,s.goods_name=e[i].goods_name,s.goods_price=e[i].goods_price,s.goods_image=e[i].goods_image,this.selection.push(s)):this.selection.push(e[i]),this.ids.push(e[i].id)}for(var o=this.selection.length-1;o>=0;o--)-1===t.indexOf(this.selection[o].id)&&(this.selection.splice(o,1),this.ids.splice(o,1))}else this.selectedRowKeys=t,this.selection=e;this.$emit("selected",this.selection)},onSearch:function(t){this.params.page=1,this.params.keyword=t,this.getGoods()},getGoods:function(){var t=this;this.tabLoading=!0;var e=this.params,i="";i="goods"===this.linkType?a["a"].action.goods_lists:a["a"].action.secKillGoodList,r["a"].get(i,e).then((function(e){0===e.code?(t.listField=e.result.field,t.listField[0].width=50,t.listField[1].width=150,"goods"===t.linkType?t.listField[2].scopedSlots={customRender:"goods_image"}:t.listField[3].scopedSlots={customRender:"goods_image"},t.listField[2].width=120,t.listField[3].width=120,t.listField[4].width=120,t.listField[5].width=120,t.listField[6].width=120,t.listField[7].width=120,t.pages=e.result.lists,t.listData=e.result.lists.data,t.tabLoading=!1):l["a"].showError(e.message)})).catch((function(t){l["a"].showError(t)}))},openModel:function(){this.visible=!0},selectGoods:function(){this.visible=!1,this.$emit("selectOk",this.selection)}})},h=m,g=(i("970e"),i("9ca4")),p=Object(g["a"])(h,s,o,!1,null,"09624b16",null);e["a"]=p.exports},"3d24":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mr24"},[i("a-form",[i("a-form-item",[i("a-card",{attrs:{title:"设置规则名称",bordered:!1}},[i("div",{staticClass:"coupon-name"},[i("a-row",{attrs:{type:"flex",align:"middle"}},[i("a-col",{staticClass:"add-label",attrs:{xs:{span:24},md:{span:3}}},[t._v("\n            名称：\n          ")]),i("a-col",{attrs:{xs:{span:24},md:{span:6,offset:1}}},[i("a-input",{model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name",e)},expression:"formItem.name"}})],1)],1)],1)])],1),i("a-form-item",[i("goodsCard",{on:{"get-goods":t.getItem}})],1),i("a-form-item",[i("a-card",{attrs:{title:"设置规则",bordered:!1}},[i("div",{staticClass:"items"},[i("a-row",[i("a-col",{staticClass:"add-label first-label",attrs:{xs:{span:24},md:{span:3}}},[t._v("\n              促销规则：\n            ")]),i("a-col",{attrs:{xs:{span:24},md:{span:20,offset:1}}},[i("div",{staticClass:"rule-btn"},[1==t.routerIndex?i("a-button",{attrs:{icon:"plus"},on:{click:t.addRule}},[t._v("添加满减规则")]):t._e(),1==t.routerIndex?i("a-button",{staticStyle:{"margin-left":"10px"},on:{click:t.addOverRule}},[t._v("设置叠加满减规则")]):i("a-button",{attrs:{icon:"plus"},on:{click:t.addRule}},[t._v("添加满折规则")])],1),1==t.routerIndex?i("div",t._l(t.formItem.rule,(function(e,s){return i("div",{staticClass:"rule-item"},[t._v("\n                  消费满 "),i("a-input",{staticStyle:{width:"90px"},attrs:{min:"1",type:"number"},model:{value:e.condition,callback:function(i){t.$set(e,"condition",i)},expression:"item.condition"}}),t._v(" 减 "),i("a-input",{staticStyle:{width:"90px"},attrs:{type:"number",min:"1"},model:{value:e.num,callback:function(i){t.$set(e,"num",i)},expression:"item.num"}}),0!==s?i("a",{on:{click:function(e){return t.delRule(s)}}},[t._v(" 删除")]):t._e()],1)})),0):i("div",t._l(t.formItem.rule,(function(e,s){return i("div",{staticClass:"rule-item"},[t._v("\n                  消费满 "),i("a-input",{staticStyle:{width:"90px"},attrs:{min:"1",type:"number"},model:{value:e.condition,callback:function(i){t.$set(e,"condition",i)},expression:"item.condition"}}),t._v(" 支付原价的 "),i("a-input",{staticStyle:{width:"90px"},attrs:{type:"number",min:"1"},model:{value:e.num,callback:function(i){t.$set(e,"num",i)},expression:"item.num"}}),t._v(" % 价格购买\n                  "),0!==s?i("a",{on:{click:function(e){return t.delRule(s)}}},[t._v(" 删除")]):t._e()],1)})),0)])],1),i("a-row",[i("a-col",{staticClass:"add-label",attrs:{xs:{span:24},md:{span:3}}},[t._v("\n              规则描述：\n            ")]),i("a-col",{attrs:{xs:{span:24},md:{span:20,offset:1}}},[i("a-input",{attrs:{rows:3,type:"textarea"},model:{value:t.formItem.desc,callback:function(e){t.$set(t.formItem,"desc",e)},expression:"formItem.desc"}})],1)],1),i("a-row",{attrs:{type:"flex",align:"middle"}},[i("a-col",{staticClass:"add-label",attrs:{xs:{span:24},md:{span:3}}},[t._v("\n              有效期：\n            ")]),i("a-col",{attrs:{xs:{span:24},md:{span:7,offset:1}}},[i("a-range-picker",{attrs:{showTime:"",format:"YYYY/MM/DD HH:mm:ss"},on:{change:t.timeChange}})],1)],1),i("a-row",{attrs:{type:"flex",align:"middle"}},[i("a-col",{staticClass:"add-label",attrs:{xs:{span:24},md:{span:3}}},[t._v("\n              与积分抵扣同享：\n            ")]),i("a-col",{attrs:{xs:{span:24},md:{span:7,offset:1}}},[i("a-radio-group",{attrs:{name:"radioGroup"},model:{value:t.formItem.is_use_point,callback:function(e){t.$set(t.formItem,"is_use_point",e)},expression:"formItem.is_use_point"}},[i("a-radio",{attrs:{value:0}},[t._v("否")]),i("a-radio",{attrs:{value:1}},[t._v("是")])],1)],1)],1)],1)])],1),i("a-form-item",{staticClass:"btn-item"},[i("a-button",{attrs:{type:"primary",size:"large",disabled:t.is_submit},on:{click:t.submitData}},[t._v("保存")]),i("a-button",{attrs:{size:"large"},on:{click:t.goback}},[t._v("取消")])],1)],1),i("a-modal",{attrs:{title:"叠加满减规则"},on:{ok:t.overRuleOk},model:{value:t.overRuleVisible,callback:function(e){t.overRuleVisible=e},expression:"overRuleVisible"}},[t._v("\n    消费满 "),i("a-input-number",{staticStyle:{width:"90px"},attrs:{min:1},model:{value:t.overRule.condition,callback:function(e){t.$set(t.overRule,"condition",e)},expression:"overRule.condition"}}),t._v(" 减 "),i("a-input-number",{staticStyle:{width:"90px"},attrs:{min:1},on:{change:t.numChange},model:{value:t.overRule.num,callback:function(e){t.$set(t.overRule,"num",e)},expression:"overRule.num"}}),t._v("，满减上限 "),i("a-input-number",{staticStyle:{width:"120px"},attrs:{placeholder:"优惠倍数金额",min:1,disabled:""==t.overRule.num},model:{value:t.overRule.doubling,callback:function(e){t.$set(t.overRule,"doubling",e)},expression:"overRule.doubling"}})],1)],1)},o=[],n=(i("5ab2"),i("6d57"),i("e10e"),i("cc57"),i("ce3c")),a=i("9f3a"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-card",{attrs:{title:"选择适用商品",bordered:!1}},[i("getGoods",{on:{selectOk:t.getGoodsList}},[i("a-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"large"}},[t._v("选择商品")])],1),i("ul",{staticClass:"item-lists"},t._l(t.formItem.limit_goods,(function(e,s){return i("li",[i("a-row",{attrs:{type:"flex",align:"middle"}},[i("a-col",{attrs:{xs:12,sm:18}},[i("div",{staticClass:"goods-item"},[i("div",{staticClass:"imgBox"},[i("img",{attrs:{src:e.goods_image,alt:""}})]),i("div",[i("p",[t._v(t._s(e.goods_name))]),i("p",{staticClass:"col-red"},[t._v("￥"+t._s(e.goods_price))])])])]),i("a-col",{attrs:{xs:6,sm:3}},[i("a",{on:{click:function(e){return t.delGoods(s)}}},[t._v("删除")])])],1)],1)})),0)],1)},l=[],c=i("358b"),d={components:{getGoods:c["a"]},data:function(){return{formItem:{limit_goods:[],is_bind_goods:"1"}}},methods:{getGoodsList:function(t){if(0==this.formItem.limit_goods.length){for(var e=[],i=0;i<t.length;i++)e[i]={id:t[i].id,goods_name:t[i].goods_name,goods_price:t[i].goods_price,goods_image:t[i].goods_image};this.formItem.limit_goods=e}else for(var s=0;s<t.length;s++){var o={id:t[s].id,goods_name:t[s].goods_name,goods_price:t[s].goods_price,goods_image:t[s].goods_image};-1===JSON.stringify(this.formItem.limit_goods).indexOf(JSON.stringify(o))&&this.formItem.limit_goods.push(o)}},delGoods:function(t){this.formItem.limit_goods.splice(t,1)}},mounted:function(){},watch:{formItem:{deep:!0,handler:function(){this.$emit("get-goods",this.formItem.limit_goods)}}}},u=d,m=(i("79c3"),i("9ca4")),h=Object(m["a"])(u,r,l,!1,null,"5cdad9aa",null),g=h.exports;function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var b=["普通会员","SVIP会员","VIP会员"],_=["app端","wap端","pc端"],v={name:"add",components:{goodsCard:g},data:function(){return{is_submit:!1,checkAll:!1,checkAll2:!1,overRuleVisible:!1,plainOptions:b,channelOptions:_,checkedChannel:[],routerIndex:1,checkedList:[],formItem:{name:"",desc:"",type:1,limit_goods:[],user_type:[],is_bind_goods:0,star_time:"",end_time:"",is_use_point:1,rule:[{condition:"",num:""}],channel:[]},overRule:{condition:"",num:"",doubling:""}}},methods:f(f({},Object(a["b"])({addActivity:"marketing/addActivity"})),{},{getItem:function(t){0===t.length?this.formItem.is_bind_goods=0:this.formItem.is_bind_goods=1,this.formItem.limit_goods=t,console.log(this.formItem)},addRule:function(){this.formItem.rule.push({condition:"",num:""})},addOverRule:function(t){this.overRuleVisible=!0},overRuleOk:function(){var t=this.overRule;if(t.num>t.condition)return this.$notification.error({message:"优惠金额要大于满减金额"}),!1;if(t.doubling<t.num)return this.$notification.error({message:"满减上限金额要大于优惠金额"}),this.overRule.doubling=t.num,!1;var e=t.doubling%t.num;if(0!==e)return this.overRule.doubling=t.doubling-e,this.$notification.error({message:"满减上限金额与优惠金额是倍数关系"}),!1;for(var i=[],s=0;s<t.doubling/t.num;s++)i.push({condition:t.condition*(s+1),num:t.num*(s+1)});console.log(i),this.formItem.rule=[],this.formItem.rule=i,this.overRuleVisible=!1},numChange:function(t){this.overRule.doubling=t},delRule:function(t){this.formItem.rule.splice(t,1)},timeChange:function(t,e){this.formItem.star_time=e[0],this.formItem.end_time=e[1]},onChange:function(t){this.checkAll=t.length===b.length},onCheckAllChange:function(t){Object.assign(this,{checkedList:t.target.checked?b:[],checkAll:t.target.checked})},onChange2:function(t){this.checkAll2=t.length===_.length},onCheckAllChange2:function(t){Object.assign(this,{checkedChannel:t.target.checked?_:[],checkAll2:t.target.checked})},submitData:function(){var t=this;this.is_submit=!0,this.formItem.user_type=this.checkedList,this.formItem.channel=this.checkedChannel,0==this.formItem.limit_goods.length&&(this.formItem.is_bind_goods=0),console.log(this.formItem.limit_goods),this.addActivity({formItem:this.formItem}),setTimeout((function(){t.$nextTick((function(){t.is_submit=!1}))}),2e3)},goback:function(){2==this.routerIndex?this.$router.push({path:"/marketing/discount"}):this.$router.push({path:"/marketing/fullminus"})}}),mounted:function(){"add_discount"==this.$router.history.current.name&&(this.routerIndex=2,this.formItem.type=2)}},y=v,k=(i("4504"),Object(m["a"])(y,s,o,!1,null,"7d6f5c5c",null));e["default"]=k.exports},4504:function(t,e,i){"use strict";var s=i("9ef6"),o=i.n(s);o.a},"4e7d":function(t,e,i){},"79c3":function(t,e,i){"use strict";var s=i("4e7d"),o=i.n(s);o.a},"970e":function(t,e,i){"use strict";var s=i("9765"),o=i.n(s);o.a},9765:function(t,e,i){},"9ef6":function(t,e,i){}}]);