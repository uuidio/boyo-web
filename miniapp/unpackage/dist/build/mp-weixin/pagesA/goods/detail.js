require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesA/goods/detail"],{"4e99":function(t,i,e){"use strict";var o,s=function(){var t=this,i=t.$createElement,o=(t._self._c,JSON.stringify(t.detail)),s=t.pickType(t.detail.pick_type),n=t.__map(t.groups,(function(i,e){var o=t.getTime(i.end_time);return{$orig:t.__get_orig(i),m1:o}})),u=t.__map(t.coupon_list,(function(i,e){var o=Number(i.origin_condition),s=Number(i.denominations),n=Number(i.origin_condition);return{$orig:t.__get_orig(i),m2:o,m3:s,m4:n}})),a=e("6e69"),c=e("4740"),d=t.__map(t.coupon_list,(function(i,e){var o=Number(i.denominations),s=Number(i.origin_condition);return{$orig:t.__get_orig(i),m7:o,m8:s}}));t._isMounted||(t.e0=function(i){t.showCouponPopup=!0},t.e1=function(i){t.showCouponPopup=!1}),t.$mp.data=Object.assign({},{$root:{g0:o,m0:s,l0:n,l1:u,m5:a,m6:c,l2:d}})},n=[];e.d(i,"b",(function(){return s})),e.d(i,"c",(function(){return n})),e.d(i,"a",(function(){return o}))},"5bb8":function(t,i,e){"use strict";e.r(i);var o=e("eaaf"),s=e.n(o);for(var n in o)"default"!==n&&function(t){e.d(i,t,(function(){return o[t]}))}(n);i["default"]=s.a},"63c2":function(t,i,e){"use strict";e.r(i);var o=e("4e99"),s=e("5bb8");for(var n in s)"default"!==n&&function(t){e.d(i,t,(function(){return s[t]}))}(n);e("f709");var u,a=e("f0c5"),c=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,"05fc22e8",null,!1,o["a"],u);i["default"]=c.exports},"8bd8":function(t,i,e){},b4b4:function(t,i,e){"use strict";(function(t){e("cf0c");o(e("66fd"));var i=o(e("63c2"));function o(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},eaaf:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=d(e("0cb3")),s=d(e("2704")),n=d(e("1d66")),u=d(e("ed4a")),a=d(e("669a")),c=e("164d");function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){e.e("components/tag/tag").then(function(){return resolve(e("e41d"))}.bind(null,e)).catch(e.oe)},r=function(){e.e("components/tag/coupon").then(function(){return resolve(e("8253"))}.bind(null,e)).catch(e.oe)},g=function(){e.e("components/bottom-popup/bottom-popup").then(function(){return resolve(e("b022"))}.bind(null,e)).catch(e.oe)},h=function(){e.e("components/numberbox/numberbox").then(function(){return resolve(e("5a8b"))}.bind(null,e)).catch(e.oe)},p=function(){e.e("components/header/ToHome").then(function(){return resolve(e("a5c4"))}.bind(null,e)).catch(e.oe)},f=function(){e.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-count-down/uni-count-down").then(function(){return resolve(e("b840"))}.bind(null,e)).catch(e.oe)},_={name:"detail",mixins:[n.default,u.default,a.default],components:{EmTag:l,TagCoupon:r,tuiBottomPopup:g,tuiNumberbox:h,toHome:p,uniCountdown:f},data:function(){return{goodsTid:{},couponTid:{},agent:-1,agent_id:"",skuMiniPrice:null,groups:[],showCouponPopup:!1,height:64,top:0,scrollH:0,popupShow:!1,detail:{},carouselList:s.default.goodsDetail.images,bannerIndex:0,goodsContent:s.default.goodsDetail.content,headTab:[],selectedTab:0,value:1,rateLists:[],coupon_list:[],sku:[],skuLists:[],skuSelect:[],skuKey:"",goodsSkuItem:{},isSeckill:!1,isGroup:!1,isIntegral:!1,point:0,downSecond:0,seckillInfo:[],couponShowInfo:[],btnIfLists:[],goods_id:0,group_id:0,groupsNum:0,payTypeGroup:!0,skuIndex:0,cartNum:0,groupDisbale:!0,showNumber:!0}},computed:{pickType:function(){return function(t){if(t){for(var i=t.concat([]),e=0;e<i.length;e++)"0"===i[e]?i[e]="快递":"1"===i[e]?i[e]="自提":"2"===i[e]&&(i[e]="配送到家");return i.toString()}}}},onReady:function(){},onLoad:function(i){var e=this;if(i.scene){var o=decodeURIComponent(i.scene),s=o.split("&");if(3===s.length){var n=s[0].substring(2),u=s[1].substring(3),a=s[2].substring(4);this.showMsg=n+"-"+u+"-"+a,this.goods_id=a,this.agent_id=u,this.getGoodsDetail([a]);var c=t.getStorageSync("user_token");c&&this.setGoodsRelated(),"g"===n&&(n="goods"),t.setStorage({key:"source",data:n,success:function(){}}),t.setStorage({key:"pid",data:u,success:function(){}}),t.setStorage({key:"gid",data:a,success:function(){}})}}else if(i.t){t.setStorage({key:"source",data:i.t,success:function(){}}),t.setStorage({key:"pid",data:i.p,success:function(){}}),t.setStorage({key:"gid",data:i.g,success:function(){}}),this.goods_id=i.g,this.agent_id=i.p,this.getGoodsDetail([i.g]);var d=t.getStorageSync("user_token");d&&this.setGoodsRelated()}else this.goods_id=i.id,i.point_activity?(this.getGoodsDetail([i.id,"point_activity"]),this.isIntegral=!0,this.point=i.point):this.getGoodsDetail([i.id]);var l={};l=wx.getMenuButtonBoundingClientRect(),t.getSystemInfo({success:function(t){e.width=l.left||t.windowWidth,e.height=l.top?l.top+l.height+8:t.statusBarHeight+44,e.top=l.top?l.top+(l.height-32)/2:t.statusBarHeight+6,e.scrollH=t.windowWidth}})},onShow:function(){var i=t.getStorageSync("user_token");if(i)this.getCartNum(),this.getAgentType(),this.agent_id&&this.setGoodsRelated();else if(this.cartNum=0,console.log("agent_id"+this.agent_id),this.agent_id)return void this.toLink("/pagesB/user/bindUser")},methods:{goodsShare:function(t){this.$http({aurl:"userShare",data:{share_type:"goods",fid:t},success:function(t){console.log(t)},fail:function(t){console.log(t)},complete:function(t){}})},getCodeDetail:function(){var t=this;this.$http({aurl:"createWxMiniQr",params:{id:this.detail.id},success:function(i){0===i.data.code&&t.needTokenQueryLink("/pagesB/goods/goodsCode",{id:t.detail.id})},fail:function(t){console.log(t)},complete:function(t){}})},setTemplate:function(){1==this.agent&&this.goodsTid.temids.length>0&&(0,c.showTuisong)(this.goodsTid.temids,this.goodsTid.setids,"您尚未开启推广订单订阅消息推送权限，请打开勾选订阅消息权限")},setGoodsRelated:function(){console.log("pid"+this.agent_id),this.$http({aurl:"setRelated",params:{pid:this.agent_id},success:function(t){console.log(t)},fail:function(t){console.log(t)}})},getGoodsTemId:function(t){this.goodsTid=t},getCouponTemId:function(t){this.couponTid=t},onShareAppMessage:function(i){var e="";if(1==this.agent){var o=t.getStorageSync("user_info"),s=JSON.parse(o).user_id;e="/pagesA/goods/detail?g="+this.detail.id+"&t=goods&p="+s,this.goodsShare(s)}else{var n=t.getStorageSync("user_info");if(n){var u=JSON.parse(n).user_id;this.goodsShare(u)}e="/pagesA/goods/detail?id="+this.detail.id}return console.log(e),{path:e}},getAgentType:function(){var t=this;this.$http({aurl:"applyCheck",success:function(i){t.agent=i.data.result.apply_status,t.partner_role=i.data.result.partner_role},fail:function(t){console.log(t)},complete:function(t){}})},toCart:function(i){t.reLaunch({url:i})},getCartNum:function(){var t=this;this.$http({aurl:"getCarNum",success:function(i){var e=0;e=i.data.result.num<=99?i.data.result.num:"99+",t.cartNum=e},fail:function(t){console.log(t)}})},getTime:function(t){var i=o.default.toTimeStamp(o.default.toFullTime())/1e3,e=o.default.toTimeStamp(t)/1e3;return e-i},getGroupOrder:function(){var t=this;this.$http({aurl:"groupGoodsOrder",params:{id:this.goods_id},success:function(i){t.groups=i.data.result.list,t.groupsNum=i.data.result.now_join_group},fail:function(t){console.log(t)}})},userGetCoupon:function(t,i){var e=this,o={coupon_id:t.id};this.$http({aurl:"receive",data:o,success:function(t){e.showAlert("领取成功"),e.$set(e.btnIfLists,i,!e.btnIfLists[i]),(0,c.showTuisong)(e.couponTid.temids,e.couponTid.setids,"您尚未开启优惠券过期订阅消息推送权限，请打开勾选订阅消息权限")},fail:function(t){}})},couponDetail:function(t){this.$set(this.couponShowInfo,t,!this.couponShowInfo[t])},timeUp:function(){t.showToast({title:"活动结束,下次早点来~",icon:"none"}),this.isSeckill=!1},payClick:function(i,e){var o=t.getStorageSync("user_token");if(o)if(-1===this.skuSelect.indexOf("占位")){e?this.group_id=0:this.isGroup&&(this.goodsSkuItem=this.detail.group_spec_list[this.skuIndex],this.goodsSkuItem.group_activty_id&&(this.group_id=this.goodsSkuItem.group_activty_id));var s={quantity:this.value,type:i,sku_id:""};if(this.isSeckill){var n=this.detail.sec_kill_info[0].seckill_ap_id;s.actSign="seckill",s.activity_id=n}this.isGroup&&0!==this.group_id&&(s.actSign="is_group",s.activity_id=this.group_id),this.isIntegral&&(s.actSign="point_goods"),null===this.detail.goods_spec?s.sku_id=this.detail.spec_list[0].id:s.sku_id=this.goodsSkuItem.id,this.addCart(i,s),this.popupShow=!1,this.initSku()}else t.showToast({title:"请选择完商品规格",icon:"none"});else this.toLink("/pagesA/user/bindUser")},addCart:function(i,e){var o=this;this.$http({aurl:"addCart",data:e,success:function(e){if("cart"===i)t.showToast({title:"加入购物车成功"}),o.getCartNum();else{var s=o;t.setStorage({key:"type",data:"fastbuy",success:function(){s.needTokenLink("/pagesA/checkout/index")}})}},fail:function(i){t.showToast({title:i.message.msg,icon:"none"})}})},skuActive:function(t,i,e){this.sku[t].active=i,this.skuSelect[t]=e,this.skuActiveChange()},skuActiveChange:function(){if(-1===this.skuSelect.indexOf("占位")){this.skuKey="";var t=this;this.skuSelect.forEach((function(i){t.skuKey+=i+"_"})),t.skuKey=t.skuKey.slice(0,t.skuKey.length-1),this.skuIndex=this.skuLists.indexOf(t.skuKey),this.isGroup&&this.payTypeGroup?this.goodsSkuItem=this.detail.group_spec_list[this.skuIndex]:this.goodsSkuItem=this.detail.spec_list[this.skuIndex],this.goodsSkuItem.group_activty_id?(this.group_id=this.goodsSkuItem.group_activty_id,this.groupDisbale=!0):(this.groupDisbale=!1,this.group_id=0),this.value=1}},initSku:function(){if(this.sku=[],this.skuKey="",this.skuSelect=[],this.isGroup?(this.goodsSkuItem=this.detail.group_spec_list[0],this.group_id=this.goodsSkuItem.group_activty_id):this.goodsSkuItem=this.detail.spec_list[0],this.value=1,null!==this.detail.goods_spec){for(var t=0;t<this.detail.spec_name.length;t++){var i={title:"",lists:[],active:-1};i.title=this.detail.spec_name[t];for(var e=0;e<this.detail.goods_spec[t].length;e++)i.lists.push(this.detail.goods_spec[t][e]);this.sku.push(i),this.skuSelect.push("占位")}for(var o=0;o<this.detail.spec_list.length;o++)this.skuLists.push(this.detail.spec_list[o].spec_sign)}},getGoodsDetail:function(i){var e=this;this.$http({aurl:"getGoodsDetail",aPath:i,needErrTips:!1,success:function(i){console.log("log",i),e.detail=i.data.result,1==i.data.result.is_group&&e.getGroupOrder(),e.isSeckill=1==i.data.result.is_sec_kill,e.isGroup=1==i.data.result.is_group;var s=e.detail.goods_body,n=new RegExp("<img","gi");if(s=s.replace(n,'<img style="max-width: 100%; display:block"'),e.detail.goods_body=s,e.isGroup&&null===e.detail.goods_spec&&(e.group_id=e.detail.spec_list[0].group_activty_id),e.isSeckill||e.isGroup){e.isSeckill?e.seckillInfo=e.detail.sec_kill_info[0]:e.seckillInfo=e.detail.is_group_info[0];var u=o.default.toTimeStamp(o.default.toFullTime())/1e3,a=o.default.toTimeStamp(e.seckillInfo.end_time)/1e3;e.downSecond=a-u}else if(e.detail.sku.length>0){for(var c=e.detail.sku[0].price,d=0;d<e.detail.sku.length;d++)c>e.detail.sku[d].price&&(c=e.detail.sku[d].price);e.skuMiniPrice=c}var l=e.detail.seckill_goods;l.status&&t.showModal({title:"",content:l.msg,showCancel:!0,confirmColor:"#5C6F97",success:function(i){i.confirm?t.navigateTo({url:"/pagesB/activity/seckillDetail?activity_id=".concat(l.activity_id,"&sku_id=").concat(l.sku_id,"&goods_id=").concat(l.goods_id,"&gm_id=").concat(l.gm_id)}):i.cancel}})},fail:function(i){if(700===i.code)e.RefuseBrowse(i.message);else if(101===i.code){console.log("log101",i);var o=i.result;e.isIntegral=!0,e.point=o.point,e.getGoodsDetail([o.goods_id,"point_activity"])}else t.showToast({title:i.message,icon:"none"})},complete:function(){t.hideLoading()}}),this.$http({aurl:"getGoodsRate",aPath:[this.goods_id],success:function(t){e.rateLists=t.data.result.data},fail:function(t){console.log(t)}})},bannerChange:function(t){this.bannerIndex=t.detail.current},change:function(t){this.value=t.value},hidePopup:function(){this.popupShow=!1},showPopup:function(t){this.isGroup?(this.goodsSkuItem=t?this.detail.group_spec_list[this.skuIndex]:this.detail.spec_list[this.skuIndex],this.payTypeGroup=t,this.popupShow=!0):this.popupShow=!0},favoriteToggle:function(i,e){var o=this;this.$http({aurl:i,data:{goods_id:this.detail.id},success:function(i){o.detail.is_favorite=!o.detail.is_favorite,t.showToast({title:e})},fail:function(t){}})},tapFavorite:function(){var t=this.detail.is_favorite;t?this.favoriteToggle("goodFavoriteCancel","取消收藏成功"):this.favoriteToggle("goodsFavorite","收藏成功")}},watch:{popupShow:function(t){this.showNumber=t},detail:function(){var i=this;this.initSku();var e=t.getStorageSync("user_token"),o="";o=e?"getCouPon":"getCouPonNoLogin",this.$http({aurl:o,params:{goods_id:this.detail.id,page_size:1e5},success:function(t){i.coupon_list=t.data.result.data;for(var e=0;e<i.coupon_list.length;e++)i.couponShowInfo.push(!1),i.btnIfLists.push(!1)},fail:function(t){console.log(t)}})}}};i.default=_}).call(this,e("543d")["default"])},f709:function(t,i,e){"use strict";var o=e("8bd8"),s=e.n(o);s.a}},[["b4b4","common/runtime","common/vendor","pagesA/common/vendor"]]]);