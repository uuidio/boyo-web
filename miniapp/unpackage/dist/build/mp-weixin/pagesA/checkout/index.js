require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesA/checkout/index"],{"2a74":function(t,e,i){"use strict";var o,s=function(){var t=this,e=t.$createElement,o=(t._self._c,t.formatPrice(t.goodsPrice)),s=t.formatPrice(t.goodsPrice),n=t.formatPrice(t.realPrice),c=t.formatPrice(t.realPrice),a=t.formatPrice(t.realPrice),r=t.formatPrice(t.realPrice),u=t.formatPrice(t.realPrice),p=i("6e69"),h=i("4740"),d=t.__map(t.showCouponItem,(function(e,i){var o=Number(e.coupon_info.denominations),s=Number(e.coupon_info.origin_condition);return{$orig:t.__get_orig(e),m9:o,m10:s}})),l=i("6e69"),f=t.__map(t.plarformCoupon,(function(e,i){var o=Number(e.coupon_info.denominations),s=Number(e.coupon_info.origin_condition);return{$orig:t.__get_orig(e),m12:o,m13:s}})),m=t.formatPrice(t.realPrice),_=t.formatPrice(t.realPrice);t._isMounted||(t.e0=function(e){t.showPopup=!1},t.e1=function(e){t.showPlatform=!1}),t.$mp.data=Object.assign({},{$root:{m0:o,m1:s,m2:n,m3:c,m4:a,m5:r,m6:u,m7:p,m8:h,l0:d,m11:l,l1:f,m14:m,m15:_}})},n=[];i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return o}))},"39e3":function(t,e,i){"use strict";i.r(e);var o=i("2a74"),s=i("4de1");for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);i("dcce");var c,a=i("f0c5"),r=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,"27afd369",null,!1,o["a"],c);e["default"]=r.exports},"4de1":function(t,e,i){"use strict";i.r(e);var o=i("b4d2"),s=i.n(o);for(var n in o)"default"!==n&&function(t){i.d(e,t,(function(){return o[t]}))}(n);e["default"]=s.a},"674f":function(t,e,i){},a37f:function(t,e,i){"use strict";(function(t){i("cf0c");o(i("66fd"));var e=o(i("39e3"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},b4d2:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;o(i("0cb3"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){i.e("components/checkOut/selectAddress").then(function(){return resolve(i("79e4"))}.bind(null,i)).catch(i.oe)},n=function(){i.e("components/payment-popup/payment-popup").then(function(){return resolve(i("5c7d"))}.bind(null,i)).catch(i.oe)},c={components:{selectAddress:s,paymentPopup:n},computed:{allGoodsPrice:function(){var t=this.goods.reduce((function(t,e){return t+100*e.goods_price*e.quantity}),0);return t},realPrice:function(){var t=0;return t=this.goodsPrice+this.shopPostFee-(this.point.use?100*this.point.fee:0),this.allCouponPrice.forEach((function(e){t-=100*e})),this.selectType.length&&this.selectType.map((function(e,i){"active"===e.type&&0!==e.actIndex&&(t-=100*e.actItem.discount_fee)})),t-=100*this.plarform_coupon_price,t}},data:function(){return{currentPay:{},isShowPayPwd:!1,showPayDetail:!1,goodsPrice:0,pointFee:0,active:0,trimStr:"",couponText:[],showPayment:!0,showPopup:!1,changeRadio:"",checkOutInfo:{},checkOutLists:[],showCouponItem:[],goods:[],buyer_message:[],addr_id:"",DisabledBtnOne:!1,DisabledBtnTwo:!1,pick_type:0,ziti_addr:"",coupon_ids:[],checkoutType:"",coupon_show_desc:[],zitiItem:{},showIndex:0,allCouponPrice:[],useCouponPrice:0,actLists:[],point:{use:!1,show:!1,enable:!1,fee:0,info:{consume_point_fee:0,points_fee:0}},calcPrice:0,shopPostFee:0,plarformCoupon:[],showPlatform:!1,plarform_coupon_text:"选择平台优惠券",plarform_coupon_price:0,platform_coupon_id:"",plarform_coupon_show_desc:[],isGroup:!1,isIntegral:!1,singleGoods:{},allPrice:0,postFeeItem:{},locaPostFee:0,showCX:!1,seckillOrder:!1,typeNumber:0,typeFlat:!1,isSubmit:!1,payFlag:!0,zitiLists:[],pickType:"",useCoupon:!0,selectType:[],act_ids:[],isInit:!1}},onLoad:function(e){e.addr_id&&(this.addr_id=e.addr_id),this.checkoutType=t.getStorageSync("type"),e.isSeck&&(this.checkoutType=e.isSeck,this.seckillOrder=!0,this.useCoupon=!1)},onShow:function(){this.isInit=!0},watch:{},methods:{handleConfirmPay:function(){var e=this,i=this,o={pick_type:this.pick_type};0===this.pick_type?o.addr_id=this.addr_id:o.ziti_addr={ziti_addr:this.zitiItem.selectAddr,receiver_name:this.zitiItem.receiver_name,receiver_tel:this.zitiItem.receiver_tel};var s=[];this.buyer_message.map((function(t){""!==t.buyer_message&&s.push(t)})),s.length&&(o.buyer_message=s);var n=[];this.selectType.map((function(t,e){"active"===t.type&&n.push({shop_id:t.actItem.shop_id,act_id:t.actItem.id})})),n.length&&(o.act_ids=n);var c=[];this.coupon_ids.map((function(t){""!==t.coupon_id&&c.push(t)})),c.length&&(o.coupon_ids=c),""!==this.platform_coupon_id&&(o.platform_coupon_id=this.platform_coupon_id),this.checkoutType&&(o.fastbuy=1),this.point.use&&(o.consume_point_fee=this.point.info.consume_point_fee,o.points_fee=this.point.info.points_fee),o.pay_type=this.currentPay.pay_type,this.payFlag=!1,this.$http({aurl:"createOrder",data:o,success:function(i){if(0===i.data.code){var o=i.data.result.payment_id,s=e;if(e.isIntegral&&0==e.realPrice)return void s.$http({aurl:"paymentGenerate",params:{payment_id:o,pay_type:"online",pay_app:"Zero"},success:function(t){0===t.data.code&&(console.log("积分支付",t),"6"==t.data.result.res?s.redirectToLink("/pagesA/checkout/status",{status:"succ",payment_id:o}):s.redirectToLink("/pagesA/checkout/status",{status:"fail",payment_id:o}))},fail:function(t){console.log(t),s.redirectToLink("/pagesA/checkout/status",{status:"fail",payment_id:o})}});1===s.currentPay.id?t.login({provider:"weixin",success:function(t){s.$http({aurl:"wechatminipay",params:{code:t.code,payment_id:o},success:function(t){if(0===t.data.code){var e=t.data.result.url;s.payment(e,o,s)}},fail:function(t){console.log(t)}})}}):2!==s.currentPay.id&&3!==s.currentPay.id||(t.showLoading({title:"支付中..."}),s.$http({aurl:2===s.currentPay.id?"physicalPay":"walletPay",data:{payment_id:o},success:function(t){0===t.data.code&&(s.isGroup?s.redirectToLink("/pagesA/checkout/groupStatus",{status:"succ",payment_id:o}):s.redirectToLink("/pagesA/checkout/status",{status:"succ",payment_id:o}))},fail:function(t){s.redirectToLink("/pagesA/checkout/status",{status:"fail",payment_id:o})},complete:function(e){t.hideLoading()}}))}},fail:function(t){console.log(t)},complete:function(){setTimeout((function(){i.payFlag=!0}),1e3)}})},handleChangeShowPayPwd:function(t){this.isShowPayPwd=t},handleChangeCurrentPay:function(t){this.currentPay=t},handleOpenPayDetail:function(){this.showPayDetail=!0},handleClosePayDetail:function(){this.showPayDetail=!1},initSw:function(){this.point.use=!1},platformCoupon_model:function(){if(this.plarform_coupon_show_desc=[],0!==this.plarformCoupon.length){for(var t=0;t<this.plarformCoupon.length;t++)this.plarformCoupon[t].coupon_id=String(this.plarformCoupon[t].coupon_id),this.plarform_coupon_show_desc.push(!1);this.showPlatform=!0}else this.showAlert("暂无可用平台优惠券")},switchPoint:function(t){this.point.use=!this.point.use,this.point.use?this.point.fee=this.point.info.points_fee:this.point.fee=0},calcPoint:function(t){var e=this;if(0!==this.checkOutInfo.open_point){var i="";this.checkoutType&&(i="fastbuy"),t>0&&this.$http({aurl:"getPoint",data:{total_money:t,type:i},success:function(t){0===t.data.code&&(e.point.show&&0==t.data.result.consume_point_fee&&(e.point.show=!1,e.point.use=!1,e.point.enable=t.data.result.is_enable),0!==t.data.result.consume_point_fee&&(e.point.show=!0,e.point.use=!1,e.point.info=t.data.result,e.point.fee=t.data.result.points_fee,e.point.enable=t.data.result.is_enable),0!=t.data.result.freeOrderPost.status&&(e.postFeeItem=t.data.result.freeOrderPost,e.freeOrderPost(t.data.result.freeOrderPost),1===e.postFeeItem.status?e.postFeeItem.decr_fee>0&&(e.showCX=!0):e.showCX=!0))},fial:function(t){console.log(t)}})}},freeOrderPost:function(t){1==t.status?this.shopPostFee-=Number(100*t.decr_fee):-1==t.status&&(this.shopPostFee=0)},coupon_model:function(t){if(this.showIndex=t,this.coupon_show_desc=[],0!==this.checkOutLists[t].shopCouponList.length){this.showCouponItem=this.checkOutLists[t].shopCouponList;for(var e=0;e<this.showCouponItem.length;e++)this.showCouponItem[e].coupon_id=String(this.showCouponItem[e].coupon_id),this.coupon_show_desc.push(!1);this.showPopup=!0}else this.showAlert("该店铺暂无可用优惠券")},toPick:function(){var t={};t=""===this.ziti_addr?{tel:this.checkOutInfo.ziti_info.mobile,shopId:this.checkOutInfo.lists[0].shopInfo.id}:{tel:this.checkOutInfo.ziti_info.mobile,shopId:this.checkOutInfo.lists[0].shopInfo.id,ziti_addr:this.ziti_addr||"",receiver_name:this.zitiItem.receiver_name||"",selectAddr:this.zitiItem.selectAddr||""},this.toQueryLink("/pagesA/checkout/pickStore",t)},getAddr:function(t){this.addr_id=t,this.getLists()},formatPrice:function(t){return(t/100).toFixed(2)},getLists:function(){var e=this;this.goodsPrice=0,this.pointFee=0,this.shopPostFee=0,this.goods=[];var i={type:""};""!==this.addr_id&&(i.addr_id=this.addr_id,i.pick_type=this.pick_type),this.checkoutType&&(i.type=this.checkoutType),this.$http({aurl:"checkOrderLists",params:i,success:function(i){if(e.checkOutInfo=i.data.result,e.checkOutLists=i.data.result.lists,e.checkOutLists.length){if(e.singleGoods=e.checkOutLists[0].goods_lists[0],"is_group"===e.checkOutLists[0].goods_lists[0].actSign&&(e.isGroup=!0),"point_goods"===e.checkOutLists[0].goods_lists[0].actSign&&(e.isIntegral=!0,e.useCoupon=!1),e.plarformCoupon=e.checkOutInfo.coupons.platform,-1===e.checkOutInfo.pick_type.indexOf("自提")&&(e.DisabledBtnTwo=!0,e.pick_type=0,e.active=0),-1===e.checkOutInfo.pick_type.indexOf("快递")&&(e.DisabledBtnOne=!0,e.pick_type=1,e.active=1,e.getZitiLists(e.checkOutInfo.lists[0].shopInfo.id)),i.data.result.lists.forEach((function(t,i){t.shopActivityList.length&&(t.shopActivityList.unshift({name:"不使用店铺优惠"}),void 0===e.selectType[i]&&e.$set(e.selectType,i,{type:"active",actIndex:1,actItem:t.shopActivityList[1]})),0!==t.shopPostFee&&(e.shopPostFee+=100*t.shopPostFee),t.goods_lists.forEach((function(t,i){e.goodsPrice+=t.goods_price*t.quantity*100,e.pointFee+=t.point_fee*t.quantity})),e.isInit&&(e.getPlatformCoupon(),e.buyer_message.push({shop_id:t.shopInfo.id,buyer_message:""}),e.coupon_ids.push({shop_id:t.shopInfo.id,coupon_id:""})),e.couponText.push("选择店铺优惠券"),e.allCouponPrice.push(0),t.goods_lists.forEach((function(t){e.goods.push(t)}))})),e.locaPostFee=e.shopPostFee,!e.isIntegral&&0!==e.checkOutInfo.open_point&&!e.seckillOrder){var o=e;e.point.use=!1,o.calcPoint(o.formatPrice(e.realPrice))}}else t.navigateBack({delta:1})},fail:function(t){console.log(t)}})},typeClick:function(e){var i=this;if(this.isInit=!1,this.typeNumber!==e){if(this.typeFlat)return t.showToast({title:"别着急,慢点操作～",icon:"none"}),!1;if(setTimeout((function(){i.typeFlat=!1}),1e3),this.initSw(),this.typeFlat=!0,this.typeNumber=e,1===e){if(0===this.zitiLists.length&&this.getZitiLists(this.checkOutInfo.lists[0].shopInfo.id),this.DisabledBtnTwo)return void t.showToast({title:"该订单不支持自提",icon:"none"})}else if(this.DisabledBtnOne)return void t.showToast({title:"该订单不支持快递配送",icon:"none"});this.active=e,this.pick_type=e,this.getLists()}else this.typeFlat=!1},couponChange:function(t){this.coupon_ids[this.showIndex].coupon_id=t.detail,""!==t.detail?this.couponTextUpdate(t.detail):(this.couponText[this.showIndex]="选择店铺优惠券",this.$set(this.allCouponPrice,this.showIndex,0)),this.getPlatformCoupon(),this.point.use=!1,this.calcPoint(this.formatPrice(this.realPrice)),this.platform_coupon_id="",this.showPopup=!1},platformCouponChange:function(t){this.platform_coupon_id=t.detail,""!==t.detail?this.platformCouponUpdate(t.detail):(this.plarform_coupon_text="选择平台优惠券",this.$set(this,"plarform_coupon_price",0)),this.point.use=!1,this.calcPoint(this.formatPrice(this.realPrice)),this.showPlatform=!1},couponClick:function(t){this.coupon_ids[this.showIndex].coupon_id=t,""!==t?(this.$set(this.selectType,this.showIndex,{type:"coupon"}),this.couponTextUpdate(t)):(this.couponText[this.showIndex]="选择店铺优惠券",this.$set(this.allCouponPrice,this.showIndex,0)),this.getPlatformCoupon(),this.point.use=!1,this.calcPoint(this.formatPrice(this.realPrice)),this.showPopup=!1,this.platform_coupon_id=""},platformCouponClick:function(t){this.platform_coupon_id=t,""!==t?this.platformCouponUpdate(t):(this.plarform_coupon_text="选择平台优惠券",this.$set(this,"plarform_coupon_price",0)),this.point.use=!1,this.calcPoint(this.formatPrice(this.realPrice)),this.showPlatform=!1},platformCouponUpdate:function(t){for(var e=0;e<this.plarformCoupon.length;e++){var i=this.plarformCoupon[e];if(i.coupon_id===t){var o=i.coupon_info;1===o.type&&(this.plarform_coupon_text="满"+Number(o.origin_condition)+"元减"+Number(o.denominations)+"元",this.$set(this,"plarform_coupon_price",Number(o.denominations)));break}}},couponTextUpdate:function(t){for(var e=0;e<this.showCouponItem.length;e++){var i=this.showCouponItem[e];if(i.coupon_id===t){var o=i.coupon_info;1===o.type&&(this.couponText[this.showIndex]="满"+Number(o.origin_condition)+"元减"+Number(o.denominations)+"元",this.$set(this.allCouponPrice,this.showIndex,Number(o.denominations)));break}}},couponDetail:function(t){this.$set(this.coupon_show_desc,t,!this.coupon_show_desc[t])},plarform_couponDetail:function(t){this.$set(this.plarform_coupon_show_desc,t,!this.plarform_coupon_show_desc[t])},getPlatformCoupon:function(){for(var t=this,e=[],i="",o=0;o<this.coupon_ids.length;o++)""!==this.coupon_ids[o].coupon_id&&e.push(Number(this.coupon_ids[o].coupon_id));var s=[];this.selectType.map((function(t){"active"===t.type&&s.push(t.actItem.id)})),this.checkoutType&&(i="fastbuy"),this.$http({aurl:"platformCoupon",data:{coupon_ids:e,act_ids:s,type:i},success:function(e){t.plarformCoupon=e.data.result,t.plarform_coupon_text="选择平台优惠券",t.plarform_coupon_price=0},fail:function(t){console.log(t)}})},submit:function(){var e=this;this.isSubmit&&setTimeout((function(){e.isSubmit=!1}),2e3),this.isSubmit=!0;var i=this;if(0===this.pick_type){if(""===this.addr_id)return void t.showToast({title:"请填写收货人信息",icon:"none"})}else if(!this.zitiItem.receiver_name||!this.zitiItem.receiver_tel)return void t.showToast({title:"请填写提货人信息",icon:"none"});!this.isIntegral&&this.realPrice<=0?t.showToast({title:"支付金额有误，请正常使用优惠规则",icon:"none"}):this.isIntegral&&0==this.realPrice?this.handleConfirmPay():2==this.currentPay.id||3==this.currentPay.id?(this.isShowPayPwd=!0,setTimeout((function(){i.isOnFocus=!0}),400)):1==this.currentPay.id&&(this.showPayDetail=!0)},payment:function(e,i,o){t.requestPayment({nonceStr:e.nonceStr,package:e.package,timeStamp:e.timeStamp,signType:e.signType,paySign:e.paySign,success:function(t){o.isGroup?o.redirectToLink("/pagesA/checkout/groupStatus",{status:"succ",payment_id:i}):o.redirectToLink("/pagesA/checkout/status",{status:"succ",payment_id:i})},fail:function(t){o.redirectToLink("/pagesA/checkout/status",{status:"fail",payment_id:i})},complete:function(){o.seckillOrder&&(t.removeStorageSync("seckillPayTime"),t.removeStorageSync("seckillSuccess"))}})},getZitiLists:function(e){var i=this;this.$http({aurl:"ztLists",aPath:[e],success:function(e){i.zitiLists=e.data.result;var o=t.getStorageSync("defAdd");i.zitiItem.selectAddr=i.zitiLists[0].address,i.zitiItem.receiver_name=o.name,i.zitiItem.receiver_tel=o.tel,i.ziti_addr=i.zitiItem},fail:function(t){console.log(t)}})},selectActive:function(e){var i=this,o=[];this.checkOutLists[e].shopActivityList.map((function(t){o.push(t.name)})),t.showActionSheet({itemList:o,success:function(t){var o=i.checkOutLists[e].shopActivityList[t.tapIndex];i.$set(i.selectType,e,{type:"active",actIndex:t.tapIndex,actItem:o}),0!==t.tapIndex?(i.couponClick(i.trimStr),i.platformCouponClick(i.trimStr)):i.getPlatformCoupon()},fail:function(t){console.log(t.errMsg)}})}},mounted:function(){},destroyed:function(){t.removeStorageSync("type"),console.log("销毁")}};e.default=c}).call(this,i("543d")["default"])},dcce:function(t,e,i){"use strict";var o=i("674f"),s=i.n(o);s.a}},[["a37f","common/runtime","common/vendor","pagesA/common/vendor"]]]);