(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/index"],{"0788":function(e,t,n){},"0b50":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=l(n("1d66")),i=l(n("835d")),s=l(n("a001")),r=l(n("669a")),a=n("09a2"),c=l(n("0cb3")),u=n("164d");function l(e){return e&&e.__esModule?e:{default:e}}var f=function(){n.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-grid/uni-grid").then(function(){return resolve(n("9f78"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-grid-item/uni-grid-item").then(function(){return resolve(n("b50d"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(n("fdd7"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("components/lists/recommendGoods").then(function(){return resolve(n("3415"))}.bind(null,n)).catch(n.oe)},m=function(){n.e("components/modal/modal1").then(function(){return resolve(n("5edd"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/tabbar/tabbar").then(function(){return resolve(n("bc99"))}.bind(null,n)).catch(n.oe)},b=0,v=0,S=!0,_=[a.config.img_base_url+"card1.png",a.config.img_base_url+"card2.png",a.config.img_base_url+"card3.png",a.config.img_base_url+"card4.png"],w={name:"UserIndex",mixins:[o.default,i.default,r.default,s.default],components:{uniGrid:f,uniGridItem:d,uniLoadMore:h,recommendGoods:g,tuiModal:m,tabBar:p},data:function(){return{tabActive:4,tabShow:!0,firstUse:!0,modelFlag:!1,orderTemid:{},is_partner_role:0,apply_status:"",commissionShow:!1,currentClassify:"",classifyList:[],loadText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"持续更新中"},loadStatus:"loading",recommendList:[],loadMore:{current:1,last:1,flat:!1},qrCode:"",showCode:!1,imgArrs:_,imgSrc:"",coverTransform:"translateY(0px)",coverTransition:"0s",moving:!1,userInfo:{},showUser:!1,trade_num:{},bannerUrl:"",tel:"",perfectInfoShow:!1,perfectInfo:{real_name:"",sex:"请选择",birthday:"请选择",email:""},sexShow:!1,timeShow:!1,currentDate:(new Date).getTime(),minDate:c.default.toTimeStamp("1900-01-01"),actions:[{name:"男",value:1},{name:"女",value:2}]}},mounted:function(){},created:function(){},onLoad:function(){e.hideTabBar()},onShow:function(){var t=e.getStorageSync("user_token");this.getCartNum(),t?this.getUserInfo():(this.userInfo={},this.trade_num={},this.showUser=!0),this.getUserBanner(),this.getShopTel(),this.getServiceQr(),this.getClassify()},onReachBottom:function(){var e=this;this.loadMore.flat||(this.loadStatus="loading",setTimeout((function(){0!==e.recommendList.length&&e.loadMore.current++,e.getRecommend()}),500))},methods:{getCartNum:function(){this.$refs.tabbar&&this.$refs.tabbar.initCartNumber()},toWallet:function(){"{}"===JSON.stringify(this.userInfo)?e.navigateTo({url:"/pagesA/user/bindUser"}):this.hasPayPassword()},toApplets:function(){this.customTo({urlType:"xiaochengxu",valueid:"wx5a7bd5068d2ab421",value:"pagesA/user/order/lists"})},getMySetting:function(t){console.log(t);var n=this;e.getSetting({withSubscriptions:!0,success:function(e){if(e.subscriptionsSetting&&e.subscriptionsSetting.itemSettings){var o=e.subscriptionsSetting.itemSettings;console.log(o),o[t]?n.modelFlag=!1:n.modelFlag=!0}else n.modelFlag=!0;console.log(n.modelFlag)}})},getGoodsTemId:function(e){this.orderTemid=e,this.orderTemid.temids.length>0&&this.getMySetting(this.orderTemid.temids[0])},getType:function(){var e=this;this.$http({aurl:"applyCheck",success:function(t){e.apply_status=t.data.result.apply_status,t.data.result.partner_info&&(e.is_partner_role=t.data.result.partner_info.partner_role),1==e.apply_status&&(0,u.getSubscribe)(1,e.getGoodsTemId)},fail:function(e){console.log(e)},complete:function(e){}})},toGeneralize:function(){var e=this;1==this.apply_status?((0,u.showTuisong)(this.orderTemid.temids,this.orderTemid.setids,"您尚未开启推广订单订阅消息推送权限，请打开勾选订阅消息权限",this.commissionCallback),setTimeout((function(){e.commissionShow=e.modelFlag}),800)):this.needTokenLink("/pagesB/user/generalize/index")},commissionCallback:function(){this.commissionShow=!1,this.needTokenLink("/pagesB/user/generalize/index")},callCs:function(){wx.makePhoneCall({phoneNumber:""+this.tel,success:function(){console.log("拨打成功")},fail:function(){console.log("拨打失败")}})},getClassify:function(){var e=this;this.$http({aurl:"getClassify",data:{pages:"member"},success:function(t){if(e.classifyList=[],0==t.data.code)for(var n=0;n<t.data.result.length;n++)0===n?(t.data.result[n].active=!0,e.currentClassify=t.data.result[n].id):t.data.result[n].active=!1,e.classifyList.push(t.data.result[n])},error:function(e){console.log(e)}})},handleChangeClassify:function(e){for(var t=0;t<this.classifyList.length;t++)if(t===e){if(this.classifyList[t].active)return!1;this.classifyList[t].active=!0,this.currentClassify=this.classifyList[t].id,this.loadMore={current:1,last:1,flat:!1},this.loadStatus="loading",this.getRecommend(!0)}else this.classifyList[t].active=!1},getRecommend:function(e){var t=this,n=this;this.$http({aurl:"getRecommend",data:{pages:"member",title_id:n.currentClassify,page:this.loadMore.current},success:function(n){if(0===n.data.code&&n.data.result.data){var o=n.data.result;t.loadMore.last=o.last_page,e?t.recommendList=o.data:o.data.map((function(e){t.recommendList.push(e)})),t.loadMore.current===t.loadMore.last?(t.loadMore.flat=!0,t.loadStatus="noMore"):(t.loadStatus="more",t.loadMore.flat=!1)}},error:function(e){console.log(e)}})},gotoMyCoupon:function(){e.navigateTo({url:"/pagesA/user/coupon"})},gotoMyPoint:function(){this.getSubscribe(),e.navigateTo({url:"/pagesA/user/point"})},gotoIntegral:function(){e.navigateTo({url:"/pagesB/activity/integral"})},gotoCoinStore:function(){this.getSubscribe(),e.navigateTo({url:"/pagesB/activity/cattleCoinStore"})},gotoCards:function(){e.navigateTo({url:"/pagesA/user/memberCard"})},ViewImage:function(t){e.previewImage({urls:[this.qrCode],current:this.qrCode})},closeCodePopup:function(){this.showCode=!1},getServiceQr:function(){var e=this;this.$http({aurl:"getServiceQr",success:function(t){0===t.data.code&&t.data.result.weixin[0]&&t.data.result.weixin[0].url&&(e.qrCode=t.data.result.weixin[0].url)},fail:function(e){console.log(e)}})},handleShowCode:function(){this.showCode=!0},isLogin:function(){"{}"===JSON.stringify(this.userInfo)?e.navigateTo({url:"/pagesA/user/bindUser"}):this.toUserinfoSetting()},toOrder:function(){this.getSubscribe(),this.needTokenQueryLink("/pagesA/user/order/lists")},toFavorite:function(e){this.needTokenQueryLink("/pagesA/user/favorite?type="+e)},toVip:function(){e.navigateToMiniProgram({appId:"wxae84e7f8578d8883",path:"pages/electronicwindow/electronicwindow?id=70&electchannelid=1",success:function(e){console.log(e)},fail:function(e){console.log(e)},complete:function(){}})},toSetting:function(){this.needTokenQueryLink("/pagesA/user/setting/setting",{info:encodeURIComponent(JSON.stringify(this.userInfo))})},toCouponCenter:function(){console.log("11"),this.needTokenQueryLink("/pagesB/activity/couponList",{info:encodeURIComponent(JSON.stringify(this.userInfo))})},toUserinfoSetting:function(){this.needTokenQueryLink("/pagesA/user/setting/userinfoSetting",{info:encodeURIComponent(JSON.stringify(this.userInfo))})},getUserBanner:function(){var e=this;this.$http({aurl:"configItems",success:function(t){0===t.data.code&&t.data.result.user_center_bottom_image.length>0&&(e.bannerUrl=t.data.result.user_center_bottom_image[0].url)},fail:function(t){e.showUser=!0,console.log(t)}})},getShopTel:function(){var e=this;this.$http({aurl:"getShopTel",success:function(t){0===t.data.code&&t.data.result.mobile&&(e.tel=t.data.result.mobile)},fail:function(e){console.log(e)}})},getUserInfo:function(){var t=this;this.$http({aurl:"userInfo",success:function(n){if(t.userInfo=n.data.result,0===t.userInfo.is_update_info?e.setStorageSync("isPerfect",!0):t.tabShow=!0,t.userInfo.tradeinfo&&(t.trade_num=t.userInfo.tradeinfo),t.userInfo.card_type_code)switch(t.userInfo.card_type_code){case"8001":t.imgSrc=t.imgArrs[0];break;case"1001":t.imgSrc=t.imgArrs[1];break;case"1002":t.imgSrc=t.imgArrs[2];break;case"1003":t.imgSrc=t.imgArrs[3];break}t.showUser=!0},fail:function(e){t.showUser=!0,console.log(e)}})},coverTouchstart:function(e){!1!==S&&(this.coverTransition="transform .1s linear",b=e.touches[0].clientY)},coverTouchmove:function(e){v=e.touches[0].clientY;var t=v-b;t<0?this.moving=!1:(this.moving=!0,t>=80&&t<100&&(t=80),t>0&&t<=80&&(this.coverTransform="translateY(".concat(t+60,"px)")))},coverTouchend:function(){this.moving=!1,this.coverTransition="transform 0.3s cubic-bezier(.21,1.93,.53,.64)",this.coverTransform="translateY(0px)"},callUp:function(){this.tel?e.makePhoneCall({phoneNumber:String(this.tel)}):this.showAlert("暂未设置客服电话")},emailValue:function(e){this.perfectInfo.email=e.detail.value},nameValue:function(e){this.perfectInfo.real_name=e.detail.value},onSelect:function(e){this.perfectInfo.sex=e.detail.value,this.sexShow=!1},cancelModel:function(){this.sexShow=!1},onPerfectInfoTime:function(e){var t=c.default.getLocalTime(e.detail);this.perfectInfo.birthday=t,this.timeShow=!1},setPerfectInfo:function(){var t=this,n=this.perfectInfo;if(""==n.real_name)return this.showAlert("请填写真实姓名"),!1;if("请选择"==n.sex)return this.showAlert("请选择性别"),!1;if("请选择"==n.birthday)return this.showAlert("请选择生日"),!1;if(""!=n.email){var o=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;if(!o.test(n.email))return this.showAlert("邮箱格式错误"),!1}this.$http({aurl:"setPerfectInfo",data:this.perfectInfo,success:function(n){0===n.data.code?(t.showAlert(n.data.message),t.perfectInfoShow=!1,e.removeStorageSync("isPerfect"),t.tabShow=!0):t.showAlert(n.data.result)},fial:function(e){console.log(e)}})},closeAlert:function(){this.perfectInfoShow=!1},getSubscribe:function(){this.$http({aurl:"getSubscribe",data:{template:"v1"},success:function(t){if(0===t.data.code){for(var n=[],o=t.data.result.template_data,i=0;i<o.length;i++){var s=o[i].template_id;n.push(s)}console.log(n),n.length>0&&e.requestSubscribeMessage({tmplIds:n,success:function(e){console.log("同意")},fail:function(e){console.log(e)}})}}})}},onUnload:function(){this.perfectInfoShow=!0}};t.default=w}).call(this,n("543d")["default"])},"0e8a":function(e,t,n){"use strict";(function(e){n("cf0c");o(n("66fd"));var t=o(n("c178"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"1be5":function(e,t,n){"use strict";var o,i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(){return e.sexShow=!0},e.e1=function(){return e.timeShow=!0},e.e2=function(){return e.timeShow=!1},e.e3=function(){return e.showCode=!1},e.e4=function(t){e.commissionShow=!1})},s=[];n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}))},"60d2":function(e,t,n){"use strict";var o=n("0788"),i=n.n(o);i.a},"9ec2":function(e,t,n){"use strict";n.r(t);var o=n("0b50"),i=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=i.a},c178:function(e,t,n){"use strict";n.r(t);var o=n("1be5"),i=n("9ec2");for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("60d2");var r,a=n("f0c5"),c=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,"3bb01e58",null,!1,o["a"],r);t["default"]=c.exports}},[["0e8a","common/runtime","common/vendor"]]]);