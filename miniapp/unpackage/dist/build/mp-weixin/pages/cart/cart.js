(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/cart"],{3339:function(t,s,i){"use strict";i.r(s);var e=i("82a4"),o=i.n(e);for(var n in e)"default"!==n&&function(t){i.d(s,t,(function(){return e[t]}))}(n);s["default"]=o.a},"3d96":function(t,s,i){},6979:function(t,s,i){"use strict";(function(t){i("cf0c");e(i("66fd"));var s=e(i("6e61"));function e(t){return t&&t.__esModule?t:{default:t}}t(s.default)}).call(this,i("543d")["createPage"])},"6e61":function(t,s,i){"use strict";i.r(s);var e=i("a333"),o=i("3339");for(var n in o)"default"!==n&&function(t){i.d(s,t,(function(){return o[t]}))}(n);i("abb7");var h,c=i("f0c5"),l=Object(c["a"])(o["default"],e["b"],e["c"],!1,null,"11e53d94",null,!1,e["a"],h);s["default"]=l.exports},"82a4":function(t,s,i){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var e=c(i("1d66")),o=c(i("ed4a")),n=c(i("835d")),h=c(i("669a"));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){i.e("components/button/button").then(function(){return resolve(i("3764"))}.bind(null,i)).catch(i.oe)},a=function(){i.e("components/header/ToHome").then(function(){return resolve(i("a5c4"))}.bind(null,i)).catch(i.oe)},d=function(){i.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(i("fdd7"))}.bind(null,i)).catch(i.oe)},r=function(){i.e("components/lists/recommendGoods").then(function(){return resolve(i("3415"))}.bind(null,i)).catch(i.oe)},u=function(){i.e("components/tabbar/tabbar").then(function(){return resolve(i("bc99"))}.bind(null,i)).catch(i.oe)},p={mixins:[e.default,o.default,n.default,h.default],name:"cart",data:function(){return{tabActive:3,currentClassify:"",classifyList:[],loadText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"持续更新中"},loadStatus:"loading",recommendList:[],loadMore:{current:1,last:1,flat:!1},goods:[],toName:"cart",allSelect:!1,checkedGoods:[],shopSelect:[],btnFlag:!0,selectShop:[],check:!0,editFlag:!1,lists:[],loading:!0,height:0,actLists:[],actNum:0,selectAct:[],actShop:{group_id:null,group_index:null,shop_id:null,shop_index:null}}},components:{emButton:l,toHome:a,uniLoadMore:d,recommendGoods:r,tabBar:u},onLoad:function(){t.hideTabBar(),this.getRecommend(!0)},onShow:function(){var s=t.getStorageSync("user_token");this.getCartNum(),s?(t.removeStorageSync("shopActArr"),this.getLists()):t.redirectTo({url:"/pagesA/user/bindUser?to=cart"}),this.getClassify()},created:function(){},mounted:function(){},computed:{submitBarText:function(){var t=this.checkedGoods.length;return"结算".concat(t?"(".concat(t,")"):"")},totalPrice:function(){var t=this,s=this.goods.reduce((function(s,i){return s+(-1!==t.checkedGoods.indexOf(i.id)?100*i.goods_price*i.quantity:0)}),0);return s}},onReachBottom:function(){var t=this;this.loadMore.flat||(this.loadStatus="loading",setTimeout((function(){0!==t.recommendList.length&&t.loadMore.current++,t.getRecommend()}),500))},methods:{getCartNum:function(){this.$refs.tabbar&&this.$refs.tabbar.initCartNumber()},getClassify:function(){var t=this;this.$http({aurl:"getClassify",data:{pages:"cart"},success:function(s){if(t.classifyList=[],0==s.data.code)for(var i=0;i<s.data.result.length;i++)0===i?(s.data.result[i].active=!0,t.currentClassify=s.data.result[i].id):s.data.result[i].active=!1,t.classifyList.push(s.data.result[i])},error:function(t){console.log(t)}})},handleChangeClassify:function(t){for(var s=0;s<this.classifyList.length;s++)if(s===t){if(this.classifyList[s].active)return!1;this.classifyList[s].active=!0,this.currentClassify=this.classifyList[s].id,this.loadMore={current:1,last:1,flat:!1},this.loadStatus="loading",this.getRecommend(!0)}else this.classifyList[s].active=!1},getRecommend:function(t){var s=this,i=this;this.$http({aurl:"getRecommend",data:{pages:"cart",title_id:i.currentClassify,page:this.loadMore.current},success:function(i){if(0===i.data.code&&i.data.result.data){var e=i.data.result;s.loadMore.last=e.last_page,t?s.recommendList=e.data:e.data.map((function(t){s.recommendList.push(t)})),s.loadMore.current===s.loadMore.last?(s.loadMore.flat=!0,s.loadStatus="noMore"):(s.loadStatus="more",s.loadMore.flat=!1)}},error:function(t){console.log(t)}})},jumpShop:function(s){t.navigateTo({url:"/pagesA/brand/lists?shopid="+s})},hidePopup:function(){this.popupShow=!1},init:function(){this.goods=[],this.allSelect=!1,this.checkedGoods=[],this.shopSelect=[],this.btnFlag=!0,this.selectShop=[],this.check=!0,this.editFlag=!1,this.lists=[],this.loading=!0},numChange:function(t){var s=this,i={cart_id:t.currentTarget.dataset.id,quantity:t.detail};""!==t.detail&&(this.goods.forEach((function(s){s.id===i.cart_id&&(s.quantity=t.detail)})),this.$http({aurl:"cartNumUpdate",data:i,success:function(t){s.getCartNum()},fail:function(t){console.log(t)}}))},getLists:function(){var s=this,i={gm_id:t.getStorageSync("gmToken")};this.$http({aurl:"cartLists",data:i,success:function(t){s.init();for(var i=0;i<t.data.result.groupLists.length;i++){for(var e=t.data.result.groupLists[i],o=e.lists.length-1;o>=0;o--){var n=e.lists[o];n.shopActivityList.length&&s.$set(n,"shopAct",0);for(var h=n.goods_lists.length-1;h>=0;h--)0===n.goods_lists[h].goods_info.goods_state&&n.goods_lists.splice(h,1);0===n.goods_lists.length&&e.lists.splice(o,1)}e.lists.length>0&&s.lists.push(e)}s.initData(),s.loading=!1},fail:function(s){401!==s.code||t.navigateTo({url:"/pagesA/user/login/login"})}})},getHeight:function(t){this.height=t},allSelectClick:function(t){this.$set(this,"allSelect",!t),this.selectAllFun(t)},selectAllFun:function(t){for(var s=0;s<this.lists.length;s++)this.shopSelectItem(t,s),this.boxClick(t,s)},changeSelect:function(s,i,e){if(this.checkedGoods.length>0&&this.actShop.group_id&&this.actShop.group_id!==this.lists[e].groupInfo.gm_id)return t.showToast({title:"不支持多项目结算!",icon:"none"}),!1;-1===this.shopSelect[e][i].indexOf(s)?this.shopSelect[e][i].push(s):this.shopSelect[e][i].splice(this.shopSelect[e][i].indexOf(s),1),this.actShop.group_id=this.lists[e].groupInfo.gm_id,this.actShop.group_index=e,this.actShop.shop_id=this.lists[e].lists[i].shopInfo.id,this.actShop.shop_index=i,this.ifShopIndex(i,e)},ifShopIndex:function(t,s){this.shopSelect[s][t].length===this.lists[s].lists[t].goods_lists.length?(this.$set(this.lists[s].lists[t].shopInfo,"is_checked",!0),this.selectShop[s].push(this.lists[s].lists[t].shopInfo.id)):(this.$set(this.lists[s].lists[t].shopInfo,"is_checked",!1),-1!==this.selectShop[s].indexOf(this.lists[s].lists[t].shopInfo.id)&&this.selectShop[s].splice(this.selectShop[s].indexOf(this.lists[s].lists[t].shopInfo.id),1)),this.ifGroupChecked(t,s)},ifGroupChecked:function(t,s){this.selectShop[s].length===this.lists[s].lists.length?this.$set(this.lists[s].groupInfo,"is_checked",!0):this.$set(this.lists[s].groupInfo,"is_checked",!1)},shopSelectItem:function(t,s,i){var e=this;e.lists[i].lists[s].goods_lists.forEach((function(o){t?-1!==e.shopSelect[i][s].indexOf(o.id)&&e.shopSelect[i][s].splice(e.shopSelect[i][s].indexOf(o.id),1):-1===e.shopSelect[i][s].indexOf(o.id)&&e.shopSelect[i][s].push(o.id)})),t?-1!==e.selectShop[i].indexOf(e.lists[i].lists[s].shopInfo.id)&&e.selectShop[i].splice(e.selectShop.indexOf(e.lists[i].lists[s].shopInfo.id),1):-1===e.selectShop[i].indexOf(e.lists[i].lists[s].shopInfo.id)&&e.selectShop[i].push(e.lists[i].lists[s].shopInfo.id),this.ifGroupChecked(s,i)},boxClick:function(s,i,e){if(this.checkedGoods.length>0&&this.actShop.group_id&&this.actShop.group_id!==this.lists[e].groupInfo.gm_id)return t.showToast({title:"不支持多项目结算!",icon:"none"}),!1;this.actShop.group_id=this.lists[e].groupInfo.gm_id,this.actShop.group_index=e,this.actShop.shop_id=this.lists[e].lists[i].shopInfo.id,this.actShop.shop_index=i,this.$set(this.lists[e].lists[i].shopInfo,"is_checked",!s),s?-1!==this.selectShop[e].indexOf(this.lists[e].lists[i].shopInfo.id)&&this.selectShop[e].splice(this.selectShop.indexOf(this.lists[e].lists[i].shopInfo.id),1):-1===this.selectShop[e].indexOf(this.lists[e].lists[i].shopInfo.id)&&this.selectShop[e].push(this.lists[e].lists[i].shopInfo.id),this.shopSelectItem(s,i,e,this)},groupClick:function(s,i){if(this.checkedGoods.length>0&&this.actShop.group_id&&this.actShop.group_id!==this.lists[i].groupInfo.gm_id)return t.showToast({title:"不支持多项目结算!",icon:"none"}),!1;this.actShop.group_id=this.lists[i].groupInfo.gm_id,this.actShop.group_index=i,this.$set(this.lists[i].groupInfo,"is_checked",!s);for(var e=0;e<this.lists[i].lists.length;e++)this.shopSelectItem(s,e,i),this.boxClick(s,e,i)},initShopSelect:function(t,s){this.shopSelect[s][t].length===this.lists[s].lists[t].goods_lists.length&&this.boxClick(!1,t,s)},initCheckGoods:function(){this.checkedGoods=[];for(var t=0;t<this.shopSelect.length;t++)for(var s=this.shopSelect[t],i=0;i<s.length;i++)for(var e=s[i],o=0;o<e.length;o++)this.checkedGoods.push(e[o]);this.$set(this,"btnFlag",!this.checkedGoods.length)},initData:function(){var t=this;this.lists.forEach((function(s,i){t.shopSelect.push([]),t.selectShop.push([]),s.groupInfo.is_checked=!1,s.groupInfo.is_disabled=!1,s.lists.forEach((function(e,o){var n=[];e.shopInfo.is_checked=!1,e.goods_lists.forEach((function(e){e.id=String(e.id),1===e.is_checked&&(n.push(e.id),t.actShop.group_index=i,t.actShop.group_id=s.groupInfo.gm_id),t.goods.push(e)})),t.shopSelect[i].push(n),t.initShopSelect(o,i)}))})),this.actShop.group_id&&this.lists.forEach((function(s,i){s.groupInfo.gm_id!==t.actShop.group_id&&(s.groupInfo.is_disabled=!0)}))},onSubmit:function(){t.removeStorageSync("type");var s=[];this.lists.map((function(t){t.lists.map((function(t){t.shopActivityList.length&&s.push({shop_id:t.shopInfo.id,act_id:t.shopActivityList[t.shopAct].id})}))})),t.setStorageSync("shopActArr",s),this.needTokenLink("/pagesA/checkout/index")},onDelete:function(){var s=this;this.$http({aurl:"cartDelete",data:{cart_id:this.checkedGoods},success:function(i){t.showToast({icon:"none",title:"删除成功"}),s.goods.length=s.goods.length-s.checkedGoods.length,s.deleteWap(),s.getCartNum()},fail:function(t){console.log(t)}})},deleteWap:function(){for(var t=this.lists.length-1;t>=0;t--){var s=this.lists[t].lists;if(this.lists[t].groupInfo.gm_id===this.actShop.group_id){for(var i=s.length-1;i>=0;i--){for(var e=s[i].goods_lists,o=e.length-1;o>=0;o--)for(var n=e[o],h=this.checkedGoods.length-1;h>=0;h--)n.id===this.checkedGoods[h]&&e.splice(o,1);0===e.length&&(s.splice(i,1),this.shopSelect[t].splice(i,1))}0===s.length&&(this.lists.splice(t,1),this.shopSelect.splice(t,1)),this.selectShop[t]=[]}}this.actShop.group_id=null,this.actShop.group_index=null,this.actShop.shop_id=null,this.actShop.shop_index=null,this.checkedGoods=[]},onSelectAct:function(t,s){var i=[];this.lists[s].lists[t].shopActivityList.map((function(t){i.push(t.name)}))},actUpDate:function(t,s,i){var e=this,o=this;this.$http({aurl:"cartShopAct",data:{shop_id:t},success:function(t){e.$set(o.lists[i].lists[s],"shopActivityList",t.data.result)},fail:function(t){console.log(t)}})}},watch:{shopSelect:function(){var t=this;this.initCheckGoods(),this.$http({aurl:"cartUpdate",data:{cart_ids:this.checkedGoods},success:function(s){t.actShop.shop_id&&t.actUpDate(t.actShop.shop_id,t.actShop.shop_index,t.actShop.group_index)}})}}};s.default=p}).call(this,i("543d")["default"])},a333:function(t,s,i){"use strict";var e,o=function(){var t=this,s=t.$createElement;t._self._c;t._isMounted||(t.e0=function(s){t.editFlag=!0},t.e1=function(s){t.editFlag=!1})},n=[];i.d(s,"b",(function(){return o})),i.d(s,"c",(function(){return n})),i.d(s,"a",(function(){return e}))},abb7:function(t,s,i){"use strict";var e=i("3d96"),o=i.n(e);o.a}},[["6979","common/runtime","common/vendor"]]]);