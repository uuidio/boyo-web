(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/indexCustomer"],{"1cce":function(t,e,o){},"3f14":function(t,e,o){"use strict";o.r(e);var n=o("8975"),i=o("7c36");for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("d863");var a,u=o("f0c5"),c=Object(u["a"])(i["default"],n["b"],n["c"],!1,null,"c603b99a",null,!1,n["a"],a);e["default"]=c.exports},4322:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(o("1d66")),i=a(o("ed4a")),s=a(o("835d"));function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){o.e("components/editTemps/indexView").then(function(){return resolve(o("9d80"))}.bind(null,o)).catch(o.oe)},c=function(){o.e("node-modules/_@dcloudio_uni-ui@1.2.5@@dcloudio/uni-ui/lib/uni-load-more/uni-load-more").then(function(){return resolve(o("fdd7"))}.bind(null,o)).catch(o.oe)},r=function(){o.e("components/lists/recommendGoods").then(function(){return resolve(o("3415"))}.bind(null,o)).catch(o.oe)},l=function(){o.e("components/tabbar/tabbar").then(function(){return resolve(o("bc99"))}.bind(null,o)).catch(o.oe)},d={mixins:[n.default,i.default,s.default],components:{indexView:u,uniLoadMore:c,recommendGoods:r,tabBar:l},data:function(){return{addrAuthorization:!1,agent:"",agent_id:"",showGuidePopup:!1,rewardPoint:"",showPopup:!1,showA:!1,onLoadCount:0,optionToken:"",gmToken:"",currentClassify:"",loadText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"暂无更多数据"},loadStatus:"loading",loadMore:{current:1,last:1,flat:!1},indexItemShow:!1,sltIndexItem:{name:"",id:""},indexItems:[],lists:[],timeOut:"",x:500,y:500,alertItem:{},scrollTop:0,boxHeight:0,topHeight:0,lng:"",lat:"",shop_lists:[],isProject:""}},onLoad:function(e){if(e.isProject&&(this.isProject=e.isProject),t.hideTabBar(),e.t)t.setStorage({key:"source",data:e.t,success:function(){}}),t.setStorage({key:"pid",data:e.p,success:function(){}}),this.agent_id=e.p;else if(e.scene){var o=decodeURIComponent(e.scene),n=o.split("&");if(2===n.length){var i=n[0].substring(2),s=n[1].substring(3);"g"===i&&(i="goods"),t.setStorage({key:"source",data:i,success:function(){}}),t.setStorage({key:"pid",data:s,success:function(){}}),this.agent_id=s}else{var a=n[0].substring(7);t.setStorage({key:"bounty",data:a,success:function(){}})}}this.isGetLocation()},onShow:function(){var e=t.getStorageSync("user_token");this.getCartNum(),e?(this.getAgentType(),this.agent_id&&this.setGoodsRelated()):this.agent_id&&this.toLink("/pagesB/user/bindUser?to=index")},onReachBottom:function(){},onPageScroll:function(t){this.scrollTop=t.scrollTop},methods:{getCartNum:function(){this.$refs.tabbar&&this.$refs.tabbar.initCartNumber()},judgeLoad:function(){this.addrAuthorization=!1;var e=t.getStorageSync("user_token_invalid"),o=t.getStorageSync("user_token");o&&e<=(new Date).getTime()&&(t.removeStorageSync("user_token"),t.removeStorageSync("user_info")),this.getIndexItem()},getIndexItem:function(){this.getDetail()},getNearbyProject:function(){var e=this,o=this,n=t.getStorageSync("gmToken"),i={gm_id:n};this.lng&&(i.lng=this.lng,i.lat=this.lat),this.$http({aurl:"nearbyShopNearby",params:i,success:function(n){var i=n.data.result;if(e.shop_lists=i.shop_list,0===e.shop_lists.length)return e.showAlert("小程序还没有门店开张，敬请期待！"),!1;var s=t.getStorageSync("shop_id");if(e.lng)if(s)if(s===i.nearby_shop.shop_id||e.isProject){var a=o.shop_lists.filter((function(t){return t.shop_id===s}));o.sltIndexItem.name=a[0].shop_name,o.sltIndexItem.id=a[0].shop_id,o.judgeLoad()}else t.showModal({title:"温馨提示",content:"定位查询到附近门店为（"+i.nearby_shop.shop_name+"）,设置为当前门店？",success:function(e){if(e.confirm)t.setStorageSync("shop_id",i.nearby_shop.shop_id),o.sltIndexItem.name=i.nearby_shop.shop_name,o.sltIndexItem.id=i.nearby_shop.shop_id,o.judgeLoad();else{var n=o.shop_lists.filter((function(t){return t.shop_id===s}));o.sltIndexItem.name=n[0].shop_name,o.sltIndexItem.id=n[0].shop_id,o.judgeLoad()}},fail:function(){}});else t.setStorageSync("shop_id",i.nearby_shop.shop_id),e.sltIndexItem.name=i.nearby_shop.shop_name,e.sltIndexItem.id=i.nearby_shop.shop_id,o.judgeLoad();else t.setStorageSync("shop_id",e.shop_lists[0]),e.sltIndexItem.name=e.shop_lists[0].shop_name,e.sltIndexItem.id=e.shop_lists[0].shop_id,o.judgeLoad()},fail:function(t){console.log(t)}})},getAuthorizeInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scope.userLocation",o=this;t.authorize({scope:e,success:function(){o.getLocationInfo()},fail:function(){wx.showModal({title:"温馨提示",content:"您已拒绝授权，无法获得周边信息，是否去设置打开？",confirmText:"确认",cancelText:"取消",success:function(t){t.confirm?(o.addrAuthorization=!0,wx.openSetting({success:function(t){t.authSetting["scope.userLocation"]?(o.getLocationInfo(),console.log("客户确认了")):(o.getNearbyProject(),console.log("客户没确认"))}})):(o.addrAuthorization=!1,o.getNearbyProject())}})}})},getLocationInfo:function(){var e=this;t.getLocation({type:"wgs84",success:function(t){e.lat=t.latitude.toString(),e.lng=t.longitude.toString(),e.getNearbyProject()},fail:function(t){e.getNearbyProject()}})},isGetLocation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scope.userLocation",o=this;t.getSetting({success:function(t){t.authSetting[e]?o.getLocationInfo():o.getAuthorizeInfo()}})},setGoodsRelated:function(){console.log("pid"+this.agent_id),this.$http({aurl:"setRelated",params:{pid:this.agent_id},success:function(t){console.log(t)},fail:function(t){console.log(t)}})},getAgentType:function(){var t=this;this.$http({aurl:"applyCheck",success:function(e){t.agent=e.data.result.apply_status},fail:function(t){console.log(t)},complete:function(t){}})},scroll:function(t){this.scrollTop=t.detail.scrollTop},getTop:function(){var e=t.createSelectorQuery(),o=this;e.select(".boxHeight").boundingClientRect((function(t){console.log("组件高度",t.height),o.boxHeight=t.height})).exec(),e.select(".mp-search-box").boundingClientRect((function(t){o.topHeight=t.height})).exec()},openGuidePopup:function(){var e=t.getStorageSync("guide_invalid");if(e&&e>=(new Date).getTime())return!1;e=(new Date).getTime()+2592e5,t.setStorageSync("guide_invalid",e),this.showGuidePopup=!0},closeGuidePopup:function(){this.showGuidePopup=!1},handleGetPopup:function(){t.getStorageSync("user_token")&&t.getStorageSync("user_token_invalid")>(new Date).getTime()?this.getPopup(t.getStorageSync("gmToken")):this.openGuidePopup()},rewardPoints:function(){var e=this;this.$http({aurl:"rewardPoints",data:{gm_id:t.getStorageSync("gmToken")},success:function(o){0===o.data.code&&(e.closeIntegralPopup(),t.showToast({title:o.data.message,icon:"none"}))},fail:function(t){console.log(t)}})},getPopup:function(t){var e=this;this.$http({aurl:"isSendPoints",data:{gm_id:t},success:function(t){if(0===t.data.code){var o=t.data.result;o.open_status?(e.rewardPoint=o.point,e.showIntegralPopup()):e.openGuidePopup()}},fail:function(t){console.log(t)}})},showIntegralPopup:function(){this.showPopup=!0},closeIntegralPopup:function(){this.showPopup=!1,this.openGuidePopup()},jump:function(){t.navigateTo({url:"/pagesA/index/groupProject"})},search:function(){t.navigateTo({url:"/pagesA/goods/search"})},cancelModel:function(){this.indexItemShow=!1},getDetail:function(){var e=this,o=t.getStorageSync("shop_id");this.$http({aurl:"getTmplInfo",params:{type:"tmpl",page:"shop_home",shop_id:o},success:function(t){e.lists=t.data.result},fail:function(t){e.getAlert(),console.log(t)},complete:function(){e.getAlert()}})},toAlertLink:function(){var t={urlType:this.alertItem.pop_url.value.show_type,shop_type:this.alertItem.pop_url.value.shop_type,value:this.alertItem.pop_url.value.value};this.customTo(t)},closeAlert:function(){clearInterval(this.timeOut),this.showA=!1,this.handleGetPopup()},showModel:function(){if(1===this.alertItem.pop_switch.value){var t=this;this.timeOut=setInterval((function(){t.alertItem.pop_time.value--,0===t.alertItem.pop_time.value&&(clearInterval(t.timeOut),t.showA=!1,t.handleGetPopup())}),1e3),this.showA=!0}else this.handleGetPopup()},getAlert:function(){var t=this;this.$http({aurl:"imagePop",success:function(e){0===e.data.code&&(t.alertItem=e.data.result,t.showModel())},fail:function(t){console.log(t)},complete:function(){}})}},mounted:function(){}};e.default=d}).call(this,o("543d")["default"])},5767:function(t,e,o){"use strict";(function(t){o("cf0c");n(o("66fd"));var e=n(o("3f14"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"7c36":function(t,e,o){"use strict";o.r(e);var n=o("4322"),i=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},8975:function(t,e,o){"use strict";var n,i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(){return t.showGuidePopup=!1})},s=[];o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}))},d863:function(t,e,o){"use strict";var n=o("1cce"),i=o.n(n);i.a}},[["5767","common/runtime","common/vendor"]]]);